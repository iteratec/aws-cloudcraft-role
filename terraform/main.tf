# Configure the AWS Provider

provider "aws" {
  region = "${var.aws_region}"

  #  profile = "${var.aws_profile}"

  #  access_key = "${var.aws_access_key}"
  #  secret_key = "${var.aws_secret_key}"
}

resource "aws_iam_role" "cloudcraft_role" {
  name = "cloudcraft_role"

  assume_role_policy = <<EOF
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Action": "sts:AssumeRole",
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::968898580625:root"
      },
      "Condition": {
        "StringEquals": {
          "sts:ExternalId": "${var.cloudcraft_externalID}"
        }
      }
    }
  ]
}
EOF

  tags = {
    ExternalUser = "CloudCraft"
  }
}

resource "aws_iam_role_policy" "cloudcraft_role_policy" {
  name = "cloudcraft_role_policy"
  role = "${aws_iam_role.cloudcraft_role.id}"

  policy = <<EOF
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Action": [
        "acm:DescribeCertificate",
        "acm:ListCertificates",
        "apigateway:GET",
        "application-autoscaling:DescribeScalableTargets",
        "application-autoscaling:DescribeScalingActivities",
        "application-autoscaling:DescribeScalingPolicies",
        "athena:ListNamedQueries",
        "autoscaling:DescribeAccountLimits",
        "autoscaling:DescribeAdjustmentTypes",
        "autoscaling:DescribeAutoScalingGroups",
        "autoscaling:DescribeAutoScalingInstances",
        "autoscaling:DescribeAutoScalingNotificationTypes",
        "autoscaling:DescribeLaunchConfigurations",
        "autoscaling:DescribeLifecycleHooks",
        "autoscaling:DescribeLifecycleHookTypes",
        "autoscaling:DescribeLoadBalancers",
        "autoscaling:DescribeLoadBalancerTargetGroups",
        "autoscaling:DescribeMetricCollectionTypes",
        "autoscaling:DescribeNotificationConfigurations",
        "autoscaling:DescribePolicies",
        "autoscaling:DescribeScalingActivities",
        "autoscaling:DescribeScalingProcessTypes",
        "autoscaling:DescribeScheduledActions",
        "autoscaling:DescribeTags",
        "autoscaling:DescribeTerminationPolicyTypes",
          "autoscaling-plans:Describe*",
        "aws-portal:ViewUsage",
        "batch:DescribeComputeEnvironments",
        "batch:DescribeJobDefinitions",
        "batch:DescribeJobQueues",
        "batch:DescribeJobs",
        "batch:ListJobs",
        "cloudfront:GetCloudFrontOriginAccessIdentity",
        "cloudfront:GetDistribution",
        "cloudfront:ListCloudFrontOriginAccessIdentities",
        "cloudfront:ListDistributions",
        "cloudhsm:DescribeLunaClient",
        "cloudhsm:DescribeHapg",
        "cloudhsm:DescribeHsm",
        "cloudhsm:ListAvailableZones",
        "cloudhsm:ListLunaClients",
        "cloudhsm:ListHapgs",
        "cloudhsm:ListHsms",
        "cloudsearch:DescribeAvailabilityOptions",
        "cloudsearch:DescribeDomains",
        "cloudsearch:DescribeScalingParameters",
        "cloudsearch:ListDomainNames",
        "cloudtrail:DescribeTrails",
        "cloudtrail:GetTrailStatus",
        "cloudwatch:DescribeAlarmHistory",
        "cloudwatch:DescribeAlarms",
        "cloudwatch:DescribeAlarmsForMetric",
        "cloudwatch:ListDashboards",
        "cloudwatch:ListMetrics",
        "config:DescribeComplianceByConfigRule",
        "config:DescribeComplianceByResource",
        "config:DescribeConfigRuleEvaluationStatus",
        "config:DescribeConfigRules",
        "config:DescribeConfigurationRecorderStatus",
        "config:DescribeConfigurationRecorders",
        "config:DescribeDeliveryChannelStatus",
        "config:DescribeDeliveryChannels",
        "config:ListDiscoveredResources",
        "cur:DescribeReportDefinitions",
        "datapipeline:DescribeObjects",
        "datapipeline:DescribePipelines",
        "datapipeline:ListPipelines",
        "dax:DescribeClusters",
        "dax:DescribeDefaultParameters",
        "dax:DescribeEvents",
        "dax:DescribeParameterGroups",
        "dax:DescribeParameters",
        "dax:DescribeSubnetGroups",
        "devicefarm:GetDevice",
        "devicefarm:GetDevicePool",
        "devicefarm:GetDevicePoolCompatibility",
        "devicefarm:ListDevicePools",
        "devicefarm:ListDevices",
        "devicefarm:ListProjects",
        "directconnect:DescribeConnections",
        "directconnect:DescribeConnectionsOnInterconnect",
        "directconnect:DescribeInterconnects",
        "directconnect:DescribeLocations",
        "directconnect:DescribeVirtualGateways",
        "directconnect:DescribeVirtualInterfaces",
        "discovery:DescribeAgents",
        "discovery:DescribeConfigurations",
        "discovery:DescribeExportConfigurations",
        "discovery:DescribeTags",
        "discovery:ListConfigurations",
        "dms:DescribeAccountAttributes",
        "dms:DescribeConnections",
        "dms:DescribeEndpointTypes",
        "dms:DescribeEndpoints",
        "dms:DescribeOrderableReplicationInstances",
        "dms:DescribeRefreshSchemasStatus",
        "dms:DescribeReplicationInstances",
        "dms:DescribeReplicationSubnetGroups",
        "dms:DescribeReplicationTasks",
        "dms:DescribeSchemas",
        "dms:DescribeTableStatistics",
        "ds:DescribeConditionalForwarders",
        "ds:DescribeDirectories",
        "ds:DescribeEventTopics",
        "ds:DescribeSnapshots",
        "ds:DescribeTrusts",
        "ds:ListIpRoutes",
        "ds:ListLogSubscriptions",
        "ds:ListSchemaExtensions",
        "ds:ListTagsForResource",
        "dynamodb:DescribeLimits",
        "dynamodb:DescribeReservedCapacity",
        "dynamodb:DescribeReservedCapacityOfferings",
        "dynamodb:DescribeStream",
        "dynamodb:DescribeTable",
        "dynamodb:ListStreams",
        "dynamodb:ListTables",
        "dynamodb:ListTagsOfResource",
        "ec2-reports:ViewReservedInstanceUtilizationReport",
        "ec2-reports:ViewInstanceUsageReport",
        "ec2:DescribeAccountAttributes",
        "ec2:DescribeAddresses",
        "ec2:DescribeAvailabilityZones",
        "ec2:DescribeBundleTasks",
        "ec2:DescribeClassicLinkInstances",
        "ec2:DescribeConversionTasks",
        "ec2:DescribeCustomerGateways",
        "ec2:DescribeDhcpOptions",
        "ec2:DescribeExportTasks",
        "ec2:DescribeHosts",
        "ec2:DescribeIdentityIdFormat",
        "ec2:DescribeIdFormat",
        "ec2:DescribeImageAttribute",
        "ec2:DescribeImages",
        "ec2:DescribeImportImageTasks",
        "ec2:DescribeImportSnapshotTasks",
        "ec2:DescribeInstanceAttribute",
        "ec2:DescribeInstances",
        "ec2:DescribeInstanceStatus",
        "ec2:DescribeInternetGateways",
        "ec2:DescribeFlowLogs",
        "ec2:DescribeKeyPairs",
        "ec2:DescribeMovingAddresses",
        "ec2:DescribeNatGateways",
        "ec2:DescribeNetworkAcls",
        "ec2:DescribeNetworkInterfaceAttribute",
        "ec2:DescribeNetworkInterfaces",
        "ec2:DescribePlacementGroups",
        "ec2:DescribePrefixLists",
        "ec2:DescribeRegions",
        "ec2:DescribeReservedInstances",
        "ec2:DescribeReservedInstancesListings",
        "ec2:DescribeReservedInstancesModifications",
        "ec2:DescribeReservedInstancesOfferings",
        "ec2:DescribeRouteTables",
        "ec2:DescribeScheduledInstanceAvailability",
        "ec2:DescribeScheduledInstances",
        "ec2:DescribeSecurityGroupReferences",
        "ec2:DescribeSecurityGroups",
        "ec2:DescribeStaleSecurityGroups",
        "ec2:DescribeSnapshotAttribute",
        "ec2:DescribeSnapshots",
        "ec2:DescribeSpotDatafeedSubscription",
        "ec2:DescribeSpotFleetInstances",
        "ec2:DescribeSpotFleetRequestHistory",
        "ec2:DescribeSpotFleetRequests",
        "ec2:DescribeSpotInstanceRequests",
        "ec2:DescribeSpotPriceHistory",
        "ec2:DescribeSubnets",
        "ec2:DescribeTags",
        "ec2:DescribeVolumeAttribute",
        "ec2:DescribeVolumes",
        "ec2:DescribeVolumeStatus",
        "ec2:DescribeVpcAttribute",
        "ec2:DescribeVpcClassicLink",
        "ec2:DescribeVpcClassicLinkDnsSupport",
        "ec2:DescribeVpcEndpoints",
        "ec2:DescribeVpcEndpointServices",
        "ec2:DescribeVpcPeeringConnections",
        "ec2:DescribeVpcs",
        "ec2:DescribeVpnConnections",
        "ec2:DescribeVpnGateways",
        "ecr:DescribeImages",
        "ecr:DescribeRepositories",
        "ecr:ListImages",
        "ecs:DescribeClusters",
        "ecs:DescribeContainerInstances",
        "ecs:DescribeServices",
        "ecs:DescribeTaskDefinition",
        "ecs:DescribeTasks",
        "ecs:ListClusters",
        "ecs:ListContainerInstances",
        "ecs:ListServices",
        "ecs:ListTaskDefinitionFamilies",
        "ecs:ListTaskDefinitions",
        "ecs:ListTasks",
        "elasticache:DescribeCacheClusters",
        "elasticache:DescribeCacheEngineVersions",
        "elasticache:DescribeCacheParameterGroups",
        "elasticache:DescribeCacheParameters",
        "elasticache:DescribeCacheSecurityGroups",
        "elasticache:DescribeCacheSubnetGroups",
        "elasticache:DescribeEngineDefaultParameters",
        "elasticache:DescribeEvents",
        "elasticache:DescribeReplicationGroups",
        "elasticache:DescribeReservedCacheNodes",
        "elasticache:DescribeReservedCacheNodesOfferings",
        "elasticache:DescribeSnapshots",
        "elasticache:ListAllowedNodeTypeModifications",
        "elasticache:ListTagsForResource",
        "elasticbeanstalk:DescribeApplicationVersions",
        "elasticbeanstalk:DescribeApplications",
        "elasticbeanstalk:DescribeConfigurationOptions",
        "elasticbeanstalk:DescribeConfigurationSettings",
        "elasticbeanstalk:DescribeEnvironmentHealth",
        "elasticbeanstalk:DescribeEnvironmentResources",
        "elasticbeanstalk:DescribeEnvironments",
        "elasticbeanstalk:DescribeEvents",
        "elasticbeanstalk:DescribeInstancesHealth",
        "elasticbeanstalk:ListAvailableSolutionStacks",
        "elasticfilesystem:DescribeTags",
        "elasticfilesystem:DescribeMountTargetSecurityGroups",
        "elasticfilesystem:DescribeFileSystems",
        "elasticfilesystem:DescribeMountTargets",
        "elasticloadbalancing:DescribeInstanceHealth",
        "elasticloadbalancing:DescribeListeners",
        "elasticloadbalancing:DescribeLoadBalancerAttributes",
        "elasticloadbalancing:DescribeLoadBalancerAttributes",
        "elasticloadbalancing:DescribeLoadBalancerPolicyTypes",
        "elasticloadbalancing:DescribeLoadBalancerPolicies",
        "elasticloadbalancing:DescribeLoadBalancers",
        "elasticloadbalancing:DescribeLoadBalancers",
        "elasticloadbalancing:DescribeRules",
        "elasticloadbalancing:DescribeSSLPolicies",
        "elasticloadbalancing:DescribeTags",
        "elasticloadbalancing:DescribeTags",
        "elasticloadbalancing:DescribeTargetGroupAttributes",
        "elasticloadbalancing:DescribeTargetGroups",
        "elasticloadbalancing:DescribeTargetHealth",
        "elasticmapreduce:DescribeCluster",
        "elasticmapreduce:DescribeJobFlows",
        "elasticmapreduce:DescribeSecurityConfiguration",
        "elasticmapreduce:DescribeStep",
        "elasticmapreduce:ListBootstrapActions",
        "elasticmapreduce:ListClusters",
        "elasticmapreduce:ListInstanceFleets",
        "elasticmapreduce:ListInstanceGroups",
        "elasticmapreduce:ListInstances",
        "elasticmapreduce:ListSecurityConfigurations",
        "elasticmapreduce:ListSteps",
        "es:DescribeElasticsearchDomain",
        "es:DescribeElasticsearchDomains",
        "es:DescribeElasticsearchDomainConfig",
        "es:ListDomainNames",
        "es:ListTags",
        "events:DescribeRule",
        "events:ListRuleNamesByTarget",
        "events:ListRules",
        "events:ListTargetsByRule",
        "firehose:DescribeDeliveryStream",
        "firehose:ListDeliveryStreams",
        "glacier:DescribeJob",
        "glacier:DescribeVault",
        "glacier:ListJobs",
        "glacier:ListMultipartUploads",
        "glacier:ListParts",
        "glacier:ListTagsForVault",
        "glacier:ListVaults",
        "importexport:ListJobs",
        "inspector:DescribeApplication",
        "inspector:DescribeAssessment",
        "inspector:DescribeCrossAccountAccessRole",
        "inspector:DescribeFinding",
        "inspector:DescribeResourceGroup",
        "inspector:DescribeRulesPackage",
        "inspector:DescribeRun",
        "inspector:DetachAssessmentAndRulesPackage",
        "inspector:ListApplications",
        "inspector:ListAssessmentAgents",
        "inspector:ListAssessments",
        "inspector:ListAttachedAssessments",
        "inspector:ListAttachedRulesPackages",
        "inspector:ListFindings",
        "inspector:ListRulesPackages",
        "inspector:ListRuns",
        "inspector:ListTagsForResource",
        "kinesis:DescribeLimits",
        "kinesis:DescribeStream",
        "kinesis:DescribeStreamSummary",
        "kinesis:ListStreams",
        "kinesis:ListTagsForStream",
        "kinesisanalytics:DescribeApplication",
        "kinesisanalytics:ListApplications",
        "lambda:GetPolicy",
        "lambda:ListAliases",
        "lambda:ListEventSourceMappings",
        "lambda:ListFunctions",
        "lambda:ListVersionsByFunction",
        "lightsail:GetActiveNames",
        "lightsail:GetBlueprints",
        "lightsail:GetBundles",
        "lightsail:GetDomain",
        "lightsail:GetDomains",
        "lightsail:GetInstance",
        "lightsail:GetInstances",
        "lightsail:GetRegions",
        "lightsail:GetStaticIps",
        "logs:DescribeDestinations",
        "logs:DescribeExportTasks",
        "logs:DescribeLogGroups",
        "logs:DescribeLogStreams",
        "logs:DescribeMetricFilters",
        "logs:DescribeSubscriptionFilters",
        "logs:ListTagsLogGroup",
        "machinelearning:DescribeBatchPredictions",
        "machinelearning:DescribeDataSources",
        "machinelearning:DescribeEvaluations",
        "machinelearning:DescribeMLModels",
        "rds:DescribeAccountAttributes",
        "rds:DescribeCertificates",
        "rds:DescribeDBClusterParameterGroups",
        "rds:DescribeDBClusterParameters",
        "rds:DescribeDBClusters",
        "rds:DescribeDBClusterSnapshotAttributes",
        "rds:DescribeDBEngineVersions",
        "rds:DescribeDBInstances",
        "rds:DescribeDBLogFiles",
        "rds:DescribeDBParameterGroups",
        "rds:DescribeDBParameters",
        "rds:DescribeDBSecurityGroups",
        "rds:DescribeDBSnapshotAttributes",
        "rds:DescribeDBSnapshots",
        "rds:DescribeDBSnapshots",
        "rds:DescribeDBSubnetGroups",
        "rds:DescribeEngineDefaultClusterParameters",
        "rds:DescribeEngineDefaultParameters",
        "rds:DescribeEventCategories",
        "rds:DescribeEvents",
        "rds:DescribeEventSubscriptions",
        "rds:DescribeOptionGroupOptions",
        "rds:DescribeOptionGroups",
        "rds:DescribeOrderableDBInstanceOptions",
        "rds:DescribePendingMaintenanceActions",
        "rds:DescribeReservedDBInstances",
        "rds:DescribeReservedDBInstancesOfferings",
        "rds:ListTagsForResource",
        "redshift:DescribeClusterParameterGroups",
        "redshift:DescribeClusterParameters",
        "redshift:DescribeClusterSecurityGroups",
        "redshift:DescribeClusterSnapshots",
        "redshift:DescribeClusterSubnetGroups",
        "redshift:DescribeClusterVersions",
        "redshift:DescribeClusters",
        "redshift:DescribeDefaultClusterParameters",
        "redshift:DescribeEventCategories",
        "redshift:DescribeEventSubscriptions",
        "redshift:DescribeEvents",
        "redshift:DescribeHsmClientCertificates",
        "redshift:DescribeHsmConfigurations",
        "redshift:DescribeLoggingStatus",
        "redshift:DescribeOrderableClusterOptions",
        "redshift:DescribeReservedNodeOfferings",
        "redshift:DescribeReservedNodes",
        "redshift:DescribeResize",
        "redshift:DescribeSnapshotCopyGrants",
        "redshift:DescribeTableRestoreStatus",
        "redshift:DescribeTags",
        "route53:GetHostedZone",
        "route53:GetHostedZoneCount",
        "route53:ListGeoLocations",
        "route53:ListHealthChecks",
        "route53:ListHostedZones",
        "route53:ListHostedZonesByName",
        "route53:ListQueryLoggingConfigs",
        "route53:ListResourceRecordSets",
        "route53:ListReusableDelegationSets",
        "route53:ListTagsForResource",
        "route53:ListTagsForResources",
        "route53:ListTrafficPolicies",
        "route53:ListTrafficPolicyInstances",
        "route53:ListTrafficPolicyInstancesByHostedZone",
        "route53:ListTrafficPolicyInstancesByPolicy",
        "route53:ListTrafficPolicyVersions",
        "route53domains:GetDomainDetail",
        "route53domains:GetDomainSuggestions",
        "route53domains:ListDomains",
        "route53domains:ListOperations",
        "route53domains:ListTagsForDomain",
        "route53domains:ViewBilling",
        "s3:ListAllMyBuckets",
        "s3:ListBucket",
        "s3:ListBucketMultipartUploads",
        "s3:ListBucketVersions",
        "sdb:ListDomains",
        "servicecatalog:DescribeConstraint",
        "servicecatalog:DescribePortfolio",
        "servicecatalog:DescribeProduct",
        "servicecatalog:DescribeProductAsAdmin",
        "servicecatalog:DescribeProductView",
        "servicecatalog:DescribeProvisioningArtifact",
        "servicecatalog:DescribeProvisioningParameters",
        "servicecatalog:DescribeRecord",
        "servicecatalog:ListAcceptedPortfolioShares",
        "servicecatalog:ListConstraintsForPortfolio",
        "servicecatalog:ListPortfolios",
        "servicecatalog:ListPortfoliosForProduct",
        "servicecatalog:ListPrincipalsForPortfolio",
        "servicecatalog:ListProvisioningArtifacts",
        "shield:DescribeProtection",
        "shield:DescribeSubscription",
        "shield:ListProtections",
        "snowball:DescribeAddress",
        "snowball:DescribeAddresses",
        "snowball:DescribeCluster",
        "snowball:DescribeJob",
        "snowball:ListClusterJobs",
        "snowball:ListClusters",
        "snowball:ListJobs",
        "sns:GetSubscriptionAttributes",
        "sns:GetTopicAttributes",
        "sns:ListEndpointsByPlatformApplication",
        "sns:ListPlatformApplications",
        "sns:ListSubscriptions",
        "sns:ListSubscriptionsByTopic",
        "sns:ListTopics",
        "sqs:GetQueueAttributes",
        "sqs:GetQueueUrl",
        "sqs:ListDeadLetterSourceQueues",
        "sqs:ListQueues",
        "waf:ListWebACLs"
      ],
      "Effect": "Allow",
      "Resource": "*"
    }
  ]
}
EOF
}
